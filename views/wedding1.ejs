<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="/css/wedding.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Tangerine:400,700"
      rel="stylesheet"
    />

    <title>A & I Wedding</title>
  </head>
  <body>
    <video autoplay muted loop id="myVideo">
      <source src="/video/bokeh1.mp4" type="video/mp4" />
    </video>

    <section class="container">
      <div class="invitation">
        <h1>
          Welcome to <br />
          Artturi's ja Ilona's wedding party
        </h1>
        <p>
          We say yes to eachother on 17.5.2019 and gather together on 18.5 to
          celebrate the beginning of marriage.
        </p>
        <p>
          Celebrations begin at 18.5. at 4 pm at Huutoniemi
          <br />address Kuninkaantie 96 Vaasa
        </p>

        <form class="form" autocomplete="off">
          <p>
            <strong>Please confirm your arrival 10.5. by the form below</strong>
          </p>
          <input
            class="decoration"
            type="text"
            name="name"
            placeholder="Name"
          />
          <input class="decoration-submit" type="submit" value="Send" />
        </form>
      </div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.12/handlebars.min.js"></script>
    <script>
      let isAlreadyPressed = false;
      document.querySelector(".form").addEventListener("submit", e => {
        let name = document.querySelector(".decoration");

        e.preventDefault();
        if (name.value === "") return;
        if (isAlreadyPressed === false) {
          isAlreadyPressed = true;
        } else {
          return;
        }

        fetch("/submit", {
          method: "POST",
          cache: "no-cache",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ name: name.value })
        })
          .then(response => {
            return response.json();
          })
          .then(result => {
            document.querySelector(".invitation").style.opacity = "0";

            setTimeout(() => {
              document.querySelector(".invitation").style.display = "none";
              let title = document.createElement("h1");
              let text = document.createTextNode(
                "Welcome " + result.name.split(" ")[0]
              );
              let para = document.createElement("p");
              let paraText = document.createTextNode("See you at 18.5 at 16pm");
              title.className = "success";

              title.appendChild(text);
              para.appendChild(paraText);

              document.querySelector(".container").append(title);
              document.querySelector(".container").append(para);
            }, 2000);
          })
          .catch(err => console.log(err));
      });
    </script>
  </body>
</html>
